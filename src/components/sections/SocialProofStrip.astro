---
/**
 * SocialProofStrip.astro — Trust Indicator Bar
 * Shows key business stats with animated counters and glowing icon cards.
 */
const stats = [
  { number: '2,500+', label: 'Homes Protected', icon: 'home' },
  { number: '14+', label: 'Years in Business', icon: 'calendar_month' },
  { number: '4.9★', label: 'Avg. Review Score', icon: 'star' },
  { number: '100%', label: 'Satisfaction Rate', icon: 'thumb_up' },
];
---

<section class="social-proof-strip theme-light" aria-label="Company Statistics">
  <div class="container">
    <div class="social-proof-strip__grid" data-reveal-group="80">
      {
        stats.map((stat) => (
          <div class="social-proof-strip__stat" data-reveal>
            <div class="social-proof-strip__icon-ring">
              <span class="material-symbols-outlined social-proof-strip__icon">{stat.icon}</span>
            </div>
            <span class="social-proof-strip__number" data-count>
              {stat.number}
            </span>
            <span class="social-proof-strip__label">{stat.label}</span>
          </div>
        ))
      }
    </div>
  </div>
</section>

<style>
  .social-proof-strip {
    background-color: var(--color-light-bg);
    background-image: linear-gradient(
      135deg,
      rgba(var(--color-primary-rgb), 0.08) 0%,
      rgba(var(--color-primary-rgb), 0.02) 100%
    );
    border-top: 1px solid rgba(var(--color-primary-rgb), 0.15);
    border-bottom: 1px solid rgba(var(--color-primary-rgb), 0.15);
    padding: var(--space-3xl) 0;
    position: relative;
    overflow: hidden;
  }

  /* Subtle dot pattern background */
  .social-proof-strip::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: radial-gradient(rgba(var(--color-primary-rgb), 0.06) 1px, transparent 1px);
    background-size: 24px 24px;
    pointer-events: none;
  }

  .social-proof-strip__grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-lg);
    text-align: center;
    position: relative;
    z-index: 1;
  }

  .social-proof-strip__stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-xl) var(--space-md);
    background: var(--color-light-bg-alt);
    border: 1px solid rgba(var(--color-primary-rgb), 0.1);
    border-radius: var(--radius-xl);
    transition: all 0.3s ease;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
  }

  .social-proof-strip__stat:hover {
    background: var(--color-light-bg-alt);
    border-color: rgba(var(--color-primary-rgb), 0.3);
    transform: translateY(-2px);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
  }

  .social-proof-strip__icon-ring {
    width: 56px;
    height: 56px;
    border-radius: var(--radius-full);
    background: rgba(var(--color-primary-rgb), 0.08);
    border: 1px solid rgba(var(--color-primary-rgb), 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: var(--space-xs);
    position: relative;
  }

  /* Subtle glow ring on hover */
  .social-proof-strip__stat:hover .social-proof-strip__icon-ring {
    background: rgba(var(--color-primary-rgb), 0.15);
    box-shadow: 0 0 24px rgba(var(--color-primary-rgb), 0.15);
    border-color: rgba(var(--color-primary-rgb), 0.4);
  }

  .social-proof-strip__icon {
    font-size: 26px;
    color: var(--color-primary);
    font-variation-settings: 'FILL' 1;
  }

  .social-proof-strip__number {
    font-size: var(--font-size-3xl);
    font-weight: var(--font-weight-black);
    color: var(--color-text-dark);
    line-height: 1;
  }

  .social-proof-strip__label {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: var(--letter-spacing-wider);
    font-weight: var(--font-weight-medium);
  }

  @media (min-width: 768px) {
    .social-proof-strip__grid {
      grid-template-columns: repeat(4, 1fr);
    }
  }
</style>

<script>
  // Animated counter for stat numbers
  (function () {
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

    function animateValue(el: HTMLElement, end: number, duration: number): void {
      const start = 0;
      const startTime = performance.now();
      const isDecimal = String(end).includes('.');
      const text = el.textContent || '';
      const suffix = text.replace(/[\d.,]+/, '');

      function update(currentTime: number): void {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const eased = 1 - Math.pow(1 - progress, 3);
        const current = start + (end - start) * eased;

        if (isDecimal) {
          el.textContent = current.toFixed(1) + suffix;
        } else {
          el.textContent = Math.round(current).toLocaleString() + suffix;
        }

        if (progress < 1) {
          requestAnimationFrame(update);
        }
      }

      requestAnimationFrame(update);
    }

    const observer = new IntersectionObserver(
      function (entries: IntersectionObserverEntry[]): void {
        entries.forEach(function (entry: IntersectionObserverEntry): void {
          if (!entry.isIntersecting) return;

          const numbers = entry.target.querySelectorAll<HTMLElement>('[data-count]');
          numbers.forEach(function (el: HTMLElement): void {
            const text = el.textContent || '';
            const numMatch = text.match(/([\d.,]+)/);
            if (numMatch) {
              const num = parseFloat(numMatch[1].replace(/,/g, ''));
              animateValue(el, num, 1800);
            }
          });

          observer.unobserve(entry.target);
        });
      },
      { threshold: 0.3 }
    );

    const section = document.querySelector('.social-proof-strip');
    if (section) observer.observe(section);
  })();
</script>
